<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.19.3 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Visualizing Motor Vehicle Fatalities with ggplot2 | Alice Tivarovsky</title>
<meta name="description" content="">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Alice Tivarovsky">
<meta property="og:title" content="Visualizing Motor Vehicle Fatalities with ggplot2">
<meta property="og:url" content="http://localhost:4000/data%20visualization/ggplot2/injuries/car-crashes/">








  <meta property="article:published_time" content="2020-07-17T00:00:00-07:00">





  

  


<link rel="canonical" href="http://localhost:4000/data%20visualization/ggplot2/injuries/car-crashes/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Alice Tivarovsky",
      "url": "http://localhost:4000/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Alice Tivarovsky Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



<!-- add htmlwidgets files -->

  
  <script src="/htmlwidgets_deps/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="/htmlwidgets_deps/plotly-binding-4.9.2.1/plotly.js"></script>
<script src="/htmlwidgets_deps/setprototypeof-0.1/setprototypeof.js"></script>
<script src="/htmlwidgets_deps/typedarray-0.1/typedarray.min.js"></script>
<script src="/htmlwidgets_deps/jquery-1.11.3/jquery.min.js"></script>
<link href="/htmlwidgets_deps/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="/htmlwidgets_deps/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="/htmlwidgets_deps/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="/htmlwidgets_deps/plotly-main-1.52.2/plotly-latest.min.js"></script>


<!-- end htmlwidgets files -->


    <!-- start custom head snippets -->
<link href="https://fonts.googleapis.com/css?family=News+Cycle:400,700" rel="stylesheet" type="text/css">
<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Alice Tivarovsky
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/_pages/posts">Blog</a>
            </li><li class="masthead__menu-item">
              <a href="/_pages/resume">Resum&eacute;</a>
            </li><li class="masthead__menu-item">
              <a href="/_pages/about">About</a>
            </li><li class="masthead__menu-item">
              <a href="/_pages/contact">Contact</a>
            </li><li class="masthead__menu-item">
              <a href="https://github.com/ativarovsky">Github</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name"></h3>
    
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Visualizing Motor Vehicle Fatalities with ggplot2">
    <meta itemprop="description" content="">
    <meta itemprop="datePublished" content="2020-07-17T00:00:00-07:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Visualizing Motor Vehicle Fatalities with ggplot2
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  24 minute read

</p>
          
          
            <p class="page__date"><strong>Updated:</strong> <time datetime="2020-07-17T00:00:00-07:00">July 17, 2020</time></p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
  <li><a href="#motivation">Motivation</a></li>
  <li><a href="#background">Background</a></li>
  <li><a href="#data-preparation">Data Preparation</a>
    <ul>
      <li><a href="#data-source">Data Source</a></li>
      <li><a href="#libraries">Libraries</a></li>
      <li><a href="#data-import">Data Import</a></li>
      <li><a href="#data-tidy">Data Tidy</a></li>
      <li><a href="#variables-used">Variables Used</a></li>
    </ul>
  </li>
  <li><a href="#visualizing-motor-vehicle-fatalities">Visualizing Motor Vehicle Fatalities</a>
    <ul>
      <li><a href="#aesthetics">Aesthetics</a></li>
      <li><a href="#boxplots">Boxplots</a></li>
      <li><a href="#violin-plots">Violin Plots</a>
        <ul>
          <li><a href="#stat_summary">stat_summary()</a></li>
        </ul>
      </li>
      <li><a href="#points-and-lines">Points and Lines</a></li>
      <li><a href="#ggplotly">ggplotly</a></li>
      <li><a href="#faceting">Faceting</a></li>
    </ul>
  </li>
  <li><a href="#conclusions">Conclusions</a></li>
  <li><a href="#further-reading">Further Reading</a></li>
  <li><a href="#references">References</a></li>
</ul>

            </nav>
          </aside>
        
        <p><em>“This is my favorite part about analytics: Taking boring flat data and bringing it to life through visualization.” – John Tukey</em></p>

<h2 id="motivation">Motivation</h2>

<p>The last two posts were a bit dense so we’ll try to keep it simple here.</p>

<p>Let’s start with a morbid stat: if you’re younger than 30 and live in the United States, your most probable cause of death is a car crash.</p>

<p>You may have already known that. But here’s a kicker - your risk of dying in a car crash is heavily influenced by the city you live in. And although metropolitan density is an obvious factor, other variables including weather, state policy, type of car involved, and emergency response capabilities play a <a href="https://www.iihs.org/topics/fatality-statistics/detail/state-by-state#fn1ref1">huge role</a>.</p>

<p>In this post, we’ll be using <code class="highlighter-rouge">ggplot2</code> - R’s de-facto plotting package <sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup> - to explore the relationship between city and motor vehicle fatalities in the US between 2010 and 2016.</p>

<p>We’ll be using data compiled from the <a href="https://www.bigcitieshealth.org">Big Cities Health Coalition</a>, a partnership organization comprised of public health leaders and thinkers from America’s largest cities. I’d never heard of BCHC prior to this and I was genuinely impressed with the wealth of data and analyses published on their site.</p>

<h2 id="background">Background</h2>

<p>In the 1950’s, the United States mortality rate due to motor vehicle crashes was about <a href="https://web.archive.org/web/20110921222129/http://www.saferoads.org/federal/2004/TrafficFatalities1899-2003.pdf">22 per 100,000</a> population. That proportion peaked at about 26 in the early 1970’s and has since been steadily falling. Despite a somewhat alarming uptick in 2015, the proportion today hovers at <a href="https://web.archive.org/web/20110921222129/http://www.saferoads.org/federal/2004/TrafficFatalities1899-2003.pdf">11 per 100,000</a>.</p>

<p>While that’s undoubtedly huge progress, it still means that more than <a href="https://www.cdc.gov/winnablebattles/report/motor.html">35,000</a> people die as a result of a motor vehicle crash every year. According to the <a href="https://www.cdc.gov/vitalsigns/motor-vehicle-safety/index.html">CDC</a>, about 1/3 of fatalities involve drunk drivers, another 1/3 involve drivers or passengers where proper restraints were not used (meaning seat belts, car seats, etc.), and another 1/3 involve drivers that were speeding.</p>

<p>Another somewhat sad statistic is that the reduction in motor vehicle fatalities in the U.S. has not kept pace with that of other high income countries. On average, high income countries reduced crash deaths by 56% between 2000 and 2013, compared with 31% in the U.S <a href="https://www.cdc.gov/vitalsigns/motor-vehicle-safety/index.html">CDC</a>. Today, the mortality rate in the U.S. (the 11 per 100,000 mentioned above) is by far the highest among high-income countries.</p>

<p>Interestingly, states that are predominantly rural tend to have higher vehicle mortality rates. Mississippi (22.5 deaths/100,000 population), South Carolina (20.4 deaths/100,000 population), and Alabama (19.5 deaths/100,000 population) represent the highest rates, while New York (4.8 deaths/100,000 population), Massachusetts (5.2 deaths/100,000 population), and New Jersey (6.3 deaths/100,000 population) represent three of the lowest <a href="https://www.iihs.org/topics/fatality-statistics/detail/state-by-state">IIHS</a>. However, this divide is much less clear when we drill down to individual cities. Cary, NC, for instance, is one of the safest cities for drivers (1.3 fatal accidents per 100,000 population), while Detroit is one of the most dangerous (16.2 fatal accidents per 100,000 population) <a href="https://www.nerdwallet.com/blog/insurance/dangerous-cities-car-drivers-2016/">Nerdwallet</a>.</p>

<p>Ok, enough sad statistics. Let’s look at some data.</p>

<h2 id="data-preparation">Data Preparation</h2>

<h3 id="data-source">Data Source</h3>

<p>These data were taken from the <a href="https://bchi.bigcitieshealth.org/indicators/1872/searches/34543">data platform page</a> on the Big Cities Health Coalition <a href="https://www.bigcitieshealth.org">website</a>.</p>

<h3 id="libraries">Libraries</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">viridis</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">plotly</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="data-import">Data Import</h3>

<p>According to the website, this dataset was updated in March 2019. As loaded, the dataset contains 34,492 rows and 15 variables. We filter for only the motor vehicle fatality portion, which leaves us with 880 observations.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">drive_df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"../data/BCHI_dataset.csv"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">janitor</span><span class="o">::</span><span class="n">clean_names</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">indicator</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Motor Vehicle Mortality Rate (Age-Adjusted; Per 100,000 people)"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="data-tidy">Data Tidy</h3>

<p>We want to make sure that the variable types R gives us are correct, variables are appropriately named, and that everything we expected in the dataframe is indeed there. We also do a quick check to make sure the data are in wide format, wherein each observation is represented by a row and each variable measured for that observation is given in a column.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str</span><span class="p">(</span><span class="n">drive_df</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## 'data.frame':	880 obs. of  15 variables:
##  $ indicator_category        : Factor w/ 13 levels "Behavioral Health/Substance Abuse",..: 9 9 9 9 9 9 9 9 9 9 ...
##  $ indicator                 : Factor w/ 61 levels "AIDS Diagnoses Rate (Per 100,000 people)",..: 21 21 21 21 21 21 21 21 21 21 ...
##  $ year                      : int  2010 2010 2010 2010 2010 2010 2010 2010 2010 2010 ...
##  $ sex                       : Factor w/ 3 levels "Both","Female",..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ race_ethnicity            : Factor w/ 9 levels "All","All ","American Indian/Alaska Native",..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ value                     : num  2.6 3.9 4.3 5.5 5.6 5.8 6.1 6.5 6.7 6.7 ...
##  $ place                     : Factor w/ 31 levels "Austin, TX","Baltimore, MD",..: 27 29 17 21 31 5 26 19 13 22 ...
##  $ bchc_requested_methodology: Factor w/ 184 levels "Age-adjusted rate of asthma-related ED visits using ICD-9-CM Codes: 493.0, 493.1, 493.2, 493.8, 493.0. (Numerat"| __truncated__,..: 133 134 133 134 133 133 133 133 133 133 ...
##  $ source                    : Factor w/ 659 levels "","(500 Cities Project)",..: 1 649 292 33 1 1 93 324 306 495 ...
##  $ methods                   : Factor w/ 291 levels "","\"Vaccinated for flu in the past 12 months\"",..: 1 1 31 275 1 1 86 237 1 1 ...
##  $ notes                     : Factor w/ 483 levels ""," Records where the value is blank in the data table indicate that the data are suppressed due to small counts, "| __truncated__,..: 472 1 1 1 1 1 1 1 1 1 ...
##  $ x90_confidence_level_low  : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ x90_confidence_level_high : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ x95_confidence_level_low  : num  2 2.5 NA 3.5 NA NA NA NA 5.1 5.4 ...
##  $ x95_confidence_level_high : num  3.4 6 NA 8.3 NA NA NA NA 8.7 7.9 ...
</code></pre></div></div>

<p>It looks like things are pretty clean. Most of the categorical variables, including race, sex, and city were read in as factors, while the mortality values and corresponding confidence intervals were read in using the double class. The only thing to fix is the <code class="highlighter-rouge">source</code>, <code class="highlighter-rouge">methods</code>, and <code class="highlighter-rouge">notes</code> variables, which should technically be strings since they don’t contain any logical levels. I’m also going to change <code class="highlighter-rouge">year</code> to a categorical variable so R doesn’t get confused trying to analyze it continuously.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">drive_df</span><span class="w"> </span><span class="o">=</span><span class="w"> 
  </span><span class="n">drive_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">year</span><span class="p">),</span><span class="w"> 
         </span><span class="n">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">source</span><span class="p">),</span><span class="w"> 
         </span><span class="n">methods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">methods</span><span class="p">),</span><span class="w">
         </span><span class="n">notes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">notes</span><span class="p">)</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="variables-used">Variables Used</h3>

<p>The variables we care about here are:</p>
<ul>
  <li><code class="highlighter-rouge">year</code>: 2010 through 2016</li>
  <li><code class="highlighter-rouge">sex</code>: Male, female, and the combined value under Both</li>
  <li><code class="highlighter-rouge">race_ethnicity</code>: American Indian/Alaska Native,  Asian/PI, Black, Hispanic, Other, White, and combined valued (All)</li>
  <li><code class="highlighter-rouge">value</code>: the mortality value we’ll be analyzing (i.e. our dependent variable); the details are given under <code class="highlighter-rouge">bchc_requested_methodology</code>, which explains that <code class="highlighter-rouge">value</code> is equal to motor vehicle deaths per 100,000 population using 2010 US Census figures, age adjusted to the 2000 census standard population. <sup id="fnref:2"><a href="#fn:2" class="footnote">2</a></sup></li>
  <li><code class="highlighter-rouge">x90_confidence_level_low</code> and <code class="highlighter-rouge">x90_confidence_level_high</code>: 90% confidence interval around <code class="highlighter-rouge">value</code></li>
  <li><code class="highlighter-rouge">x95_confidence_level_low</code> and <code class="highlighter-rouge">x95_confidence_level_high</code>: 95% confidence interval around <code class="highlighter-rouge">value</code></li>
</ul>

<h2 id="visualizing-motor-vehicle-fatalities">Visualizing Motor Vehicle Fatalities</h2>

<p><code class="highlighter-rouge">ggplot2</code> works by layering graphical elements on top of one another. These layers are referred to as “geoms” and they include things like axes, grid lines, color schemes points representing your data, trend-lines connecting your data, shaded regions representing confidence intervals, and plot labels, titles, and legends. Creating a final graph requires you to define each element individually and “add” it to the <code class="highlighter-rouge">ggplot()</code> call.</p>

<p>The best way to explain <code class="highlighter-rouge">ggplot2</code> is, of course, to demonstrate it. Let’s first just apply the function to our dataframe <code class="highlighter-rouge">drive_df</code> to see what happens.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">drive_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p><img src="/figs/2020-07-17-car-crashes/unnamed-chunk-1-1.png" alt="plot of chunk unnamed-chunk-1" /></p>

<p>We get this lovely gray square. Who doesn’t love gray squares?</p>

<p>This may seem silly but the point is to demonstrate that <code class="highlighter-rouge">ggplot2</code> needs you to state what you want.</p>

<p>The first thing we need to do is tell <code class="highlighter-rouge">ggplot2</code> what our dependent and independent variables are. We’re interested in motor vehicle mortality year over year, so let’s try the following:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">drive_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="/figs/2020-07-17-car-crashes/unnamed-chunk-2-1.png" alt="plot of chunk unnamed-chunk-2" /></p>

<p>Wait what?</p>

<p>And this is one of the first lessons of <code class="highlighter-rouge">ggplot2</code>. In order to control how things look within a geom, you have to set what are known as <strong>aesthetics</strong>.</p>

<h3 id="aesthetics">Aesthetics</h3>

<p>Aesthetics set within the ggplot function itself (i.e. before geoms are defined) are global aesthetics that apply to the entire plot. Aesthetics set within a geom apply only to that geom. Therefore, when we define axes, we want to set them globally within a <code class="highlighter-rouge">ggplot(aes()</code> call:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">drive_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><img src="/figs/2020-07-17-car-crashes/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3" /></p>

<p>Ah, now we’re getting somewhere.</p>

<p>Let’s attempt to create a plot of motor vehicle mortality as a function of year. We know that we have data from 2010 through 2016 and that the data are collected (or compiled) annually. In order to get some points for each year, we’ll need to “add” a point geom to <code class="highlighter-rouge">ggplot2</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">drive_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_point</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p><img src="/figs/2020-07-17-car-crashes/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4" height="600px" width="600px" /></p>

<p>Clearly this is a pretty bad plot and if you ever see something like this published, please assume that the author doesn’t know much about plots. For one thing, using a scatterplot doesn’t make sense because the year variable was measured categorically rather than continuously. BUT… this does show us something important in the data: <strong>outliers</strong>. On the left, we have points hovering at 70-75 deaths per 100,000. Recall that in the 1970s, when motor vehicle deaths peaked, the average values reached into the mid-20s. So clearly, 75 is astronomical. Let’s take a detour and investigate this a bit more. I’m going to go back to the dataframe and sort in order of decreasing <code class="highlighter-rouge">value</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">drive_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">head</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>##   indicator_category
## 1    Injury/Violence
## 2    Injury/Violence
## 3    Injury/Violence
## 4    Injury/Violence
## 5    Injury/Violence
## 6    Injury/Violence
##                                                         indicator year  sex
## 1 Motor Vehicle Mortality Rate (Age-Adjusted; Per 100,000 people) 2011 Both
## 2 Motor Vehicle Mortality Rate (Age-Adjusted; Per 100,000 people) 2012 Both
## 3 Motor Vehicle Mortality Rate (Age-Adjusted; Per 100,000 people) 2010 Both
## 4 Motor Vehicle Mortality Rate (Age-Adjusted; Per 100,000 people) 2012 Both
## 5 Motor Vehicle Mortality Rate (Age-Adjusted; Per 100,000 people) 2016 Both
## 6 Motor Vehicle Mortality Rate (Age-Adjusted; Per 100,000 people) 2012 Both
##                  race_ethnicity value           place
## 1                         Other  74.4      Denver, CO
## 2                         Other  74.4      Denver, CO
## 3 American Indian/Alaska Native  70.5 Minneapolis, MN
## 4 American Indian/Alaska Native  39.4 Minneapolis, MN
## 5                      Hispanic  35.6 Minneapolis, MN
## 6                      Hispanic  34.1 Minneapolis, MN
##                                                                                                                                                                                                                                                                             bchc_requested_methodology
## 1 Motor vehicle deaths per 100,000 population using 2010 US Census figures, age adjusted to the year 2000 standard population. ICD-10 Codes: V02-V04, V09.0, V09.2, V12-V14, V19.0-V19.2, V19.4-V19.6, V20-V79, V80.3-V80.5, V81.0-V81.1, V82.0-V82.1, V83-V86, V87.0-V87.8, V88.0-V88.8, V89.0, V89.2
## 2 Motor vehicle deaths per 100,000 population using 2010 US Census figures, age adjusted to the year 2000 standard population. ICD-10 Codes: V02-V04, V09.0, V09.2, V12-V14, V19.0-V19.2, V19.4-V19.6, V20-V79, V80.3-V80.5, V81.0-V81.1, V82.0-V82.1, V83-V86, V87.0-V87.8, V88.0-V88.8, V89.0, V89.2
## 3 Motor vehicle deaths per 100,000 population using 2010 US Census figures, age adjusted to the year 2000 standard population. ICD-10 Codes: V02-V04, V09.0, V09.2, V12-V14, V19.0-V19.2, V19.4-V19.6, V20-V79, V80.3-V80.5, V81.0-V81.1, V82.0-V82.1, V83-V86, V87.0-V87.8, V88.0-V88.8, V89.0, V89.2
## 4 Motor vehicle deaths per 100,000 population using 2010 US Census figures, age adjusted to the year 2000 standard population. ICD-10 Codes: V02-V04, V09.0, V09.2, V12-V14, V19.0-V19.2, V19.4-V19.6, V20-V79, V80.3-V80.5, V81.0-V81.1, V82.0-V82.1, V83-V86, V87.0-V87.8, V88.0-V88.8, V89.0, V89.2
## 5 Motor vehicle deaths per 100,000 population using 2010 US Census figures, age adjusted to the year 2000 standard population. ICD-10 Codes: V02-V04, V09.0, V09.2, V12-V14, V19.0-V19.2, V19.4-V19.6, V20-V79, V80.3-V80.5, V81.0-V81.1, V82.0-V82.1, V83-V86, V87.0-V87.8, V88.0-V88.8, V89.0, V89.2
## 6 Motor vehicle deaths per 100,000 population using 2010 US Census figures, age adjusted to the year 2000 standard population. ICD-10 Codes: V02-V04, V09.0, V09.2, V12-V14, V19.0-V19.2, V19.4-V19.6, V20-V79, V80.3-V80.5, V81.0-V81.1, V82.0-V82.1, V83-V86, V87.0-V87.8, V88.0-V88.8, V89.0, V89.2
##                              source
## 1 Colorado Vital Records Death Data
## 2 Colorado Vital Records Death Data
## 3        Minnesota Vital Statistics
## 4        Minnesota Vital Statistics
## 5        Minnesota Vital Statistics
## 6        Minnesota Vital Statistics
##                                                                                                                         methods
## 1                                                            2011-2013 years are the most recently available data at this time.
## 2                                                            2011-2013 years are the most recently available data at this time.
## 3 Rates per 100,000 calculated using the Minneapolis 2010 Census population; age-adjusted using the 2000 US standard population
## 4 Rates per 100,000 calculated using the Minneapolis 2010 Census population; age-adjusted using the 2000 US standard population
## 5                                                                                                                              
## 6 Rates per 100,000 calculated using the Minneapolis 2010 Census population; age-adjusted using the 2000 US standard population
##   notes x90_confidence_level_low x90_confidence_level_high
## 1                             NA                        NA
## 2                             NA                        NA
## 3                             NA                        NA
## 4                             NA                        NA
## 5                             NA                        NA
## 6                             NA                        NA
##   x95_confidence_level_low x95_confidence_level_high
## 1                       NA                        NA
## 2                       NA                        NA
## 3                       NA                        NA
## 4                       NA                        NA
## 5                       NA                        NA
## 6                       NA                        NA
</code></pre></div></div>

<p>The top three outliers belong to 2011 Denver, CO (74.4 deaths), 2012 Denver, CO (also 74.4 deaths), and 2010 Minneapolis, MN (70.5 deaths). What’s important is that these are race-stratified. While all three represent total values for both males and females, the Denver numbers represent data for race labeled “Other” and the Minneapolis number belongs to the American Indian/Alaska Native population. If we wanted to dig around, we could perhaps find the original Denver and Minneapolis data and double check these numbers. They might be correct or they might be attributed to typos.</p>

<p>In this case, we’re not interested in racial distribution for the moment, so we’re going to restrict our dataset to the collapsed values, meaning those representing the averages of both sexes and all races. Then we’ll re-attempt the pseudo-scatterplot.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">drive_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Both"</span><span class="p">,</span><span class="w"> </span><span class="n">race_ethnicity</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_point</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p><img src="/figs/2020-07-17-car-crashes/unnamed-chunk-6-1.png" alt="plot of chunk unnamed-chunk-6" /></p>

<p>Ok, that’s a little better, but it still doesn’t tell us anything interesting. Each year has many data points representing an individual city and on this plot, it’s impossible to tell which city corresponds to which point. We’ll come back to this question in a moment, but for now, let’s try to extract something useful from the plot. Let’s try to answer the question: <strong>on average, did motor vehicle fatalities in the U.S. increase, decrease, or remain stable between 2010 and 2016?</strong> To visualize the answer, we’ll need a plot that can show us the center value of each year, and maybe some indication of the distribution within that year. Enter the boxplot.</p>

<h3 id="boxplots">Boxplots</h3>

<p>I love a good boxplot (perhaps even more than I love a good gray square). Here’s a wonderful TDS <a href="https://towardsdatascience.com/understanding-boxplots-5e2df7bcbd51">post</a> on boxplots.</p>

<p>Let’s quickly toss in a boxplot geom:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">drive_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Both"</span><span class="p">,</span><span class="w"> </span><span class="n">race_ethnicity</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="n">geom_boxplot</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p><img src="/figs/2020-07-17-car-crashes/unnamed-chunk-7-1.png" alt="plot of chunk unnamed-chunk-7" height="600px" width="600px" /></p>

<p>Brilliant! Immediately we gleaned a useful nugget of information: there was an alarming spike in the data. Things were chugging along and then something happened in 2015. If you do a news search on this topic, you’ll see that public health and safety folks <a href="https://www.npr.org/sections/thetwo-way/2016/02/18/467230965/2015-traffic-fatalities-rose-by-largest-percent-in-50-years-safety-group-says">noticed</a> this, too. It looks like fuel prices and job growth were potential culprits, but either way, this is clearly a very useful insight.</p>

<p>Let’s spice this plot up a bit. Let’s say we want to compare men and women in the same time frame. We will need to specify a color code within the aesthetic for <code class="highlighter-rouge">geom_boxplot</code> and we’ll also need to filter out the “Both” values for sex, since we just want male vs female.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">drive_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">race_ethnicity</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All"</span><span class="p">,</span><span class="w"> </span><span class="o">!</span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Both"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sex</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="n">geom_boxplot</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p><img src="/figs/2020-07-17-car-crashes/unnamed-chunk-8-1.png" alt="plot of chunk unnamed-chunk-8" height="600px" width="600px" /></p>

<p>NICE. These are meaty results. There’s an obvious disparity in mortality between males and females. Most years, male fatality averages are more than double that of females, and some years (2015, for instance) it’s more like triple. The female boxplot for 2016 also looks suspiciously narrow. It’s worth investigating but for now let’s move on.</p>

<p>I’m not a huge fan of that color scheme, so let’s use some nicer colors. For two-tone plots, I like to just manually choose the colors (there are a million color tools online, but <a href="https://coolors.co">this one</a> is my favorite). For three or more colors, I normally use a package like <a href="https://cran.r-project.org/web/packages/RColorBrewer/RColorBrewer.pdf"><code class="highlighter-rouge">RColorBrewer</code></a> (built-in) or the extra-fancy <a href="https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html"><code class="highlighter-rouge">viridis</code></a> package, which you’d need to install. I’m also going to get rid of the gray background using a theme and change the opacity of the fill color using an <code class="highlighter-rouge">alpha</code> statement (the latter is just personal preference). Finally, I’ll capitalize the axis labels, and add a title and caption.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">drive_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">race_ethnicity</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All"</span><span class="p">,</span><span class="w"> </span><span class="o">!</span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Both"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sex</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="c1">#change outline color to gray</span><span class="w">
    </span><span class="n">geom_boxplot</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.7</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#996699"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#99CC99"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="w">
      </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Motor Vehicle Fatality Rate 2010-2016 by Sex"</span><span class="p">,</span><span class="w">
      </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Year"</span><span class="p">,</span><span class="w">
      </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Fatality (death/100,000 population)"</span><span class="p">,</span><span class="w">
      </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Data source: Big Cities Health Initiative"</span><span class="w">
    </span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="/figs/2020-07-17-car-crashes/unnamed-chunk-9-1.png" alt="plot of chunk unnamed-chunk-9" height="600px" width="600px" /></p>

<p>Great, we wound up with a nice-looking boxplot with some useful information.</p>

<h3 id="violin-plots">Violin Plots</h3>

<p>Now let’s take a look at a cousin of the boxplot: the violin plot. All you really need to know to understand how it works is shown in this figure, taken from another <a href="https://towardsdatascience.com/violin-plots-explained-fb1d115e023d">TDS post</a>.</p>

<figure class="half">
    <img src="/assets/images/violin.png" />
</figure>

<p>There was a time a few years back when everyone thought violin plots were the best thing since sliced bagels. The trend seems to have somewhat faded but I think they’re nice so let’s make one.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">drive_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Both"</span><span class="p">,</span><span class="w"> </span><span class="n">race_ethnicity</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="n">geom_violin</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p><img src="/figs/2020-07-17-car-crashes/unnamed-chunk-10-1.png" alt="plot of chunk unnamed-chunk-10" /></p>

<p>Is it just me or do these look like a Dr. Seuss version of stick-figures?</p>

<p>Anyway, these aren’t very “violin-y” but the point is that higher frequencies of values lead to wider parts of the plots and vice-versa. If we want to see a more violin shape, we can combine some of the years to get more data points per ‘violin”. Let’s do that here:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">drive_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Both"</span><span class="p">,</span><span class="w"> </span><span class="n">race_ethnicity</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">year_group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">if_else</span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2010</span><span class="p">,</span><span class="w"> </span><span class="m">2011</span><span class="p">,</span><span class="w"> </span><span class="m">2012</span><span class="p">),</span><span class="w"> </span><span class="s2">"2010-2012"</span><span class="p">,</span><span class="w"> </span><span class="s2">"2013-2016"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year_group</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="n">geom_violin</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p><img src="/figs/2020-07-17-car-crashes/unnamed-chunk-11-1.png" alt="plot of chunk unnamed-chunk-11" /></p>

<p>Much more violin-like! Clearly, the 2010-2012 group had most of its data points in the 6-6.5 range, while 2013-2016 was a bit more spread out across its range of values and its median is a bit higher (probably driven by that alarming 2015 number).</p>

<p>What if we split out males vs females like we did in our boxplots?</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">violin</span><span class="w"> </span><span class="o">=</span><span class="w"> 
</span><span class="n">drive_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Both"</span><span class="p">,</span><span class="w"> </span><span class="n">race_ethnicity</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">year_group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">if_else</span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2010</span><span class="p">,</span><span class="w"> </span><span class="m">2011</span><span class="p">,</span><span class="w"> </span><span class="m">2012</span><span class="p">),</span><span class="w"> </span><span class="s2">"2010-2012"</span><span class="p">,</span><span class="w"> </span><span class="s2">"2013-2016"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year_group</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sex</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="n">geom_violin</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.7</span><span class="p">)</span><span class="w">

</span><span class="n">violin</span><span class="w">
</span></code></pre></div></div>

<p><img src="/figs/2020-07-17-car-crashes/unnamed-chunk-12-1.png" alt="plot of chunk unnamed-chunk-12" height="600px" width="600px" /></p>

<p>Cute, right? The gender difference we saw in the boxplots is even more detailed here.</p>

<p>Let’s clean this up a bit and then we’re going to do something <strong>really</strong> exciting.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">violin_1</span><span class="w"> </span><span class="o">=</span><span class="w"> 
  </span><span class="n">violin</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#996699"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#99CC99"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="w">
      </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Motor Vehicle Fatality Rates, Early vs Mid 2000s by Sex"</span><span class="p">,</span><span class="w">
      </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Year"</span><span class="p">,</span><span class="w">
      </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Fatality (death/100,000 population)"</span><span class="p">,</span><span class="w">
      </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Data source: Big Cities Health Initiative"</span><span class="w">
    </span><span class="p">)</span><span class="w">

</span><span class="n">violin_1</span><span class="w">
</span></code></pre></div></div>

<p><img src="/figs/2020-07-17-car-crashes/unnamed-chunk-13-1.png" alt="plot of chunk unnamed-chunk-13" height="600px" width="600px" /></p>

<p>All right, let’s get extra fancy. We’re going to use a function within <code class="highlighter-rouge">ggplot2</code> called <code class="highlighter-rouge">stat_summary</code> to give us some extra detail.</p>

<h4 id="stat_summary"><code class="highlighter-rouge">stat_summary()</code></h4>

<p><code class="highlighter-rouge">stat_summary</code> does just what it sounds like - it summarizes stats. We’ve been using stats within our geoms this whole time, we just didn’t know about it because <code class="highlighter-rouge">ggplot2</code> does it in the background. For instance, the boxplot geom calculates the median, 25th, and 75th percentile stats.</p>

<p>Here, we’ll add dots to indicate the median in each violin. The <code class="highlighter-rouge">position_dodge</code> function moves the dots inside the violins, as opposed to positioning them directly on the gridline.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">violin_1</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">stat_summary</span><span class="p">(</span><span class="n">fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">median</span><span class="p">,</span><span class="w"> </span><span class="n">geom</span><span class="o">=</span><span class="s2">"point"</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">position_dodge</span><span class="p">(</span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.9</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><img src="/figs/2020-07-17-car-crashes/unnamed-chunk-14-1.png" alt="plot of chunk unnamed-chunk-14" height="600px" width="600px" /></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">violin_1</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">stat_summary</span><span class="p">(</span><span class="n">fun.data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean_sdl</span><span class="p">,</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"pointrange"</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">position_dodge</span><span class="p">(</span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.9</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><img src="/figs/2020-07-17-car-crashes/unnamed-chunk-15-1.png" alt="plot of chunk unnamed-chunk-15" height="600px" width="600px" /></p>

<p>There are lots of other stats you can layer on. You can even embed little boxplots within the violin plots. <a href="http://www.sthda.com/english/wiki/ggplot2-violin-plot-quick-start-guide-r-software-and-data-visualization">This page</a> gives a great summary, but for our purposes we’re going to end our mini-tour of violin plots here and move on.</p>

<h3 id="points-and-lines">Points and Lines</h3>

<p>Now let’s come back to our initial question of how motor vehicle fatalities differ across cities in the U.S. Recall that we started with the scatterplot below:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">drive_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Both"</span><span class="p">,</span><span class="w"> </span><span class="n">race_ethnicity</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_point</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p><img src="/figs/2020-07-17-car-crashes/unnamed-chunk-16-1.png" alt="plot of chunk unnamed-chunk-16" /></p>

<p>Every dot represents a city and every city has a value for every year of measurement, so of course we want to know which dot belongs to which city.</p>

<p>Let’s start with some basic color-coding.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">drive_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Both"</span><span class="p">,</span><span class="w"> </span><span class="n">race_ethnicity</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">place</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><img src="/figs/2020-07-17-car-crashes/unnamed-chunk-17-1.png" alt="plot of chunk unnamed-chunk-17" height="600px" width="600px" /></p>

<p>Yikes. It’s basically impossible to distinguish any of these colors from one another, or to follow the trajectory of any city year to year. We need lines rather than dots. We also need <code class="highlighter-rouge">ggplot2</code> to know that each city should be treated as a grouping (this latter point is not super intuitive to me, but just know that it doesn’t work otherwise).</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">drive_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Both"</span><span class="p">,</span><span class="w"> </span><span class="n">race_ethnicity</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">place</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_line</span><span class="p">()</span><span class="w">  
</span></code></pre></div></div>

<p><img src="/figs/2020-07-17-car-crashes/unnamed-chunk-18-1.png" alt="plot of chunk unnamed-chunk-18" height="600px" width="600px" /></p>

<p>Does this bring back fond <a href="https://etchasketch.com">Etch A Sketch</a> memories?</p>

<p>What we’ve created here is called a <strong>spaghetti plot</strong> for reasons that should be obvious. Clearly we need colors though. Let’s drop a color aesthetic into our line geom.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">spaghetti_plot</span><span class="w"> </span><span class="o">=</span><span class="w"> 
</span><span class="n">drive_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Both"</span><span class="p">,</span><span class="w"> </span><span class="n">race_ethnicity</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">place</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_line</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">place</span><span class="p">))</span><span class="w"> 

</span><span class="n">spaghetti_plot</span><span class="w">
</span></code></pre></div></div>

<p><img src="/figs/2020-07-17-car-crashes/unnamed-chunk-19-1.png" alt="plot of chunk unnamed-chunk-19" height="600px" width="600px" /></p>

<p>Double yikes. Too many similar colors. Also, too much legend.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">spaghetti_plot_1</span><span class="w"> </span><span class="o">=</span><span class="w"> 
  </span><span class="n">spaghetti_plot</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_color_viridis</span><span class="p">(</span><span class="n">discrete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bottom"</span><span class="p">,</span><span class="w"> </span><span class="n">legend.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">),</span><span class="w">
  </span><span class="n">legend.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">)</span><span class="w"> 
  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="w">
      </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Motor Vehicle Fatality Rates by City"</span><span class="p">,</span><span class="w">
      </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Year"</span><span class="p">,</span><span class="w">
      </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Fatality (death/100,000 population)"</span><span class="p">,</span><span class="w">
      </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Data source: Big Cities Health Initiative"</span><span class="w">
    </span><span class="p">)</span><span class="w">

</span><span class="n">spaghetti_plot_1</span><span class="w">
</span></code></pre></div></div>

<p><img src="/figs/2020-07-17-car-crashes/unnamed-chunk-20-1.png" alt="plot of chunk unnamed-chunk-20" height="600px" width="600px" /></p>

<p>That’s a lot better, but there’s still no way anyone would be able to distinguish Houston from Indianapolis, or even be able to infer which city has the highest crash fatality burden versus lowest. And this is where interactivity comes in handy.</p>

<p>A word of warning, it’s easy to over-do interactivity and go nuts with things like <code class="highlighter-rouge">plotly</code> because it’s fun and flashy. Don’t do it. If it doesn’t add value to visualizing patterns in the data, it doesn’t have any place on your plot.</p>

<h3 id="ggplotly"><code class="highlighter-rouge">ggplotly</code></h3>

<p>In this case, we definitely want some interactivity to help us understand the data. We’re going to use <a href="https://www.rdocumentation.org/packages/plotly/versions/4.9.2.1/topics/ggplotly"><code class="highlighter-rouge">ggplotly</code></a>, a convenient marriage of <code class="highlighter-rouge">plotly</code> and <code class="highlighter-rouge">ggplot2</code>. You can hover on a line to see which city it represents, or double any city in the legend to isolate it on the plot.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">spaghetti_plot_1</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplotly</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<div class="figure">
<!--html_preserve--><div id="htmlwidget-81a9e2a8210bea495c06" style="width:650px;height:650px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-81a9e2a8210bea495c06">{"x":{"data":[{"x":[1,3,4,5,6],"y":[null,5,4.7,4.3,3.8],"text":["place: Boston, MA<br />year: 2010<br />value:   NA<br />place: Boston, MA","place: Boston, MA<br />year: 2012<br />value:  5.0<br />place: Boston, MA","place: Boston, MA<br />year: 2013<br />value:  4.7<br />place: Boston, MA","place: Boston, MA<br />year: 2014<br />value:  4.3<br />place: Boston, MA","place: Boston, MA<br />year: 2015<br />value:  3.8<br />place: Boston, MA"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(68,1,84,1)","dash":"solid"},"hoveron":"points","name":"Boston, MA","legendgroup":"Boston, MA","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,3,4],"y":[5.8,5.7,6.5,6.3],"text":["place: Chicago, Il<br />year: 2010<br />value:  5.8<br />place: Chicago, Il","place: Chicago, Il<br />year: 2011<br />value:  5.7<br />place: Chicago, Il","place: Chicago, Il<br />year: 2012<br />value:  6.5<br />place: Chicago, Il","place: Chicago, Il<br />year: 2013<br />value:  6.3<br />place: Chicago, Il"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(71,16,99,1)","dash":"solid"},"hoveron":"points","name":"Chicago, Il","legendgroup":"Chicago, Il","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[3,4,5],"y":[7.3,7.1,6.3],"text":["place: Cleveland, OH<br />year: 2012<br />value:  7.3<br />place: Cleveland, OH","place: Cleveland, OH<br />year: 2013<br />value:  7.1<br />place: Cleveland, OH","place: Cleveland, OH<br />year: 2014<br />value:  6.3<br />place: Cleveland, OH"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(72,29,111,1)","dash":"solid"},"hoveron":"points","name":"Cleveland, OH","legendgroup":"Cleveland, OH","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,3,4,6,7],"y":[9.4,10.7,10.5,8.3,12.1,12.8],"text":["place: Columbus, OH<br />year: 2010<br />value:  9.4<br />place: Columbus, OH","place: Columbus, OH<br />year: 2011<br />value: 10.7<br />place: Columbus, OH","place: Columbus, OH<br />year: 2012<br />value: 10.5<br />place: Columbus, OH","place: Columbus, OH<br />year: 2013<br />value:  8.3<br />place: Columbus, OH","place: Columbus, OH<br />year: 2015<br />value: 12.1<br />place: Columbus, OH","place: Columbus, OH<br />year: 2016<br />value: 12.8<br />place: Columbus, OH"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(72,41,122,1)","dash":"solid"},"hoveron":"points","name":"Columbus, OH","legendgroup":"Columbus, OH","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,3,4,5,6,7],"y":[8.5,7.2,6.5,8.4,7.7,10.7,13.5],"text":["place: Denver, CO<br />year: 2010<br />value:  8.5<br />place: Denver, CO","place: Denver, CO<br />year: 2011<br />value:  7.2<br />place: Denver, CO","place: Denver, CO<br />year: 2012<br />value:  6.5<br />place: Denver, CO","place: Denver, CO<br />year: 2013<br />value:  8.4<br />place: Denver, CO","place: Denver, CO<br />year: 2014<br />value:  7.7<br />place: Denver, CO","place: Denver, CO<br />year: 2015<br />value: 10.7<br />place: Denver, CO","place: Denver, CO<br />year: 2016<br />value: 13.5<br />place: Denver, CO"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(69,53,129,1)","dash":"solid"},"hoveron":"points","name":"Denver, CO","legendgroup":"Denver, CO","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[2,3,4,5],"y":[9,12.9,12.9,13.2],"text":["place: Detroit, MI<br />year: 2011<br />value:  9.0<br />place: Detroit, MI","place: Detroit, MI<br />year: 2012<br />value: 12.9<br />place: Detroit, MI","place: Detroit, MI<br />year: 2013<br />value: 12.9<br />place: Detroit, MI","place: Detroit, MI<br />year: 2014<br />value: 13.2<br />place: Detroit, MI"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(66,65,134,1)","dash":"solid"},"hoveron":"points","name":"Detroit, MI","legendgroup":"Detroit, MI","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,3,4,5],"y":[9.3,10.9,9.9,11.6,9.8],"text":["place: Fort Worth (Tarrant County), TX<br />year: 2010<br />value:  9.3<br />place: Fort Worth (Tarrant County), TX","place: Fort Worth (Tarrant County), TX<br />year: 2011<br />value: 10.9<br />place: Fort Worth (Tarrant County), TX","place: Fort Worth (Tarrant County), TX<br />year: 2012<br />value:  9.9<br />place: Fort Worth (Tarrant County), TX","place: Fort Worth (Tarrant County), TX<br />year: 2013<br />value: 11.6<br />place: Fort Worth (Tarrant County), TX","place: Fort Worth (Tarrant County), TX<br />year: 2014<br />value:  9.8<br />place: Fort Worth (Tarrant County), TX"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(61,77,138,1)","dash":"solid"},"hoveron":"points","name":"Fort Worth (Tarrant County), TX","legendgroup":"Fort Worth (Tarrant County), TX","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,3],"y":[10.1,9.8,9.7],"text":["place: Houston, TX<br />year: 2010<br />value: 10.1<br />place: Houston, TX","place: Houston, TX<br />year: 2011<br />value:  9.8<br />place: Houston, TX","place: Houston, TX<br />year: 2012<br />value:  9.7<br />place: Houston, TX"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(56,87,140,1)","dash":"solid"},"hoveron":"points","name":"Houston, TX","legendgroup":"Houston, TX","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,3,4,5,7],"y":[6.7,7.3,5.9,6.5,5.4,8.9],"text":["place: Indianapolis (Marion County), IN<br />year: 2010<br />value:  6.7<br />place: Indianapolis (Marion County), IN","place: Indianapolis (Marion County), IN<br />year: 2011<br />value:  7.3<br />place: Indianapolis (Marion County), IN","place: Indianapolis (Marion County), IN<br />year: 2012<br />value:  5.9<br />place: Indianapolis (Marion County), IN","place: Indianapolis (Marion County), IN<br />year: 2013<br />value:  6.5<br />place: Indianapolis (Marion County), IN","place: Indianapolis (Marion County), IN<br />year: 2014<br />value:  5.4<br />place: Indianapolis (Marion County), IN","place: Indianapolis (Marion County), IN<br />year: 2016<br />value:  8.9<br />place: Indianapolis (Marion County), IN"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(52,97,141,1)","dash":"solid"},"hoveron":"points","name":"Indianapolis (Marion County), IN","legendgroup":"Indianapolis (Marion County), IN","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,3,4,5,6,7],"y":[12.6,9.8,10.7,9,9.4,10.8,11.5],"text":["place: Kansas City, MO<br />year: 2010<br />value: 12.6<br />place: Kansas City, MO","place: Kansas City, MO<br />year: 2011<br />value:  9.8<br />place: Kansas City, MO","place: Kansas City, MO<br />year: 2012<br />value: 10.7<br />place: Kansas City, MO","place: Kansas City, MO<br />year: 2013<br />value:  9.0<br />place: Kansas City, MO","place: Kansas City, MO<br />year: 2014<br />value:  9.4<br />place: Kansas City, MO","place: Kansas City, MO<br />year: 2015<br />value: 10.8<br />place: Kansas City, MO","place: Kansas City, MO<br />year: 2016<br />value: 11.5<br />place: Kansas City, MO"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(47,107,142,1)","dash":"solid"},"hoveron":"points","name":"Kansas City, MO","legendgroup":"Kansas City, MO","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,3,4,5,6],"y":[8.7,7.8,8.8,9.1,8.8,10.6],"text":["place: Las Vegas (Clark County), NV<br />year: 2010<br />value:  8.7<br />place: Las Vegas (Clark County), NV","place: Las Vegas (Clark County), NV<br />year: 2011<br />value:  7.8<br />place: Las Vegas (Clark County), NV","place: Las Vegas (Clark County), NV<br />year: 2012<br />value:  8.8<br />place: Las Vegas (Clark County), NV","place: Las Vegas (Clark County), NV<br />year: 2013<br />value:  9.1<br />place: Las Vegas (Clark County), NV","place: Las Vegas (Clark County), NV<br />year: 2014<br />value:  8.8<br />place: Las Vegas (Clark County), NV","place: Las Vegas (Clark County), NV<br />year: 2015<br />value: 10.6<br />place: Las Vegas (Clark County), NV"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(43,116,142,1)","dash":"solid"},"hoveron":"points","name":"Las Vegas (Clark County), NV","legendgroup":"Las Vegas (Clark County), NV","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[2,3,4,5],"y":[4.5,6.1,3.9,4.4],"text":["place: Long Beach, CA<br />year: 2011<br />value:  4.5<br />place: Long Beach, CA","place: Long Beach, CA<br />year: 2012<br />value:  6.1<br />place: Long Beach, CA","place: Long Beach, CA<br />year: 2013<br />value:  3.9<br />place: Long Beach, CA","place: Long Beach, CA<br />year: 2014<br />value:  4.4<br />place: Long Beach, CA"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(39,126,142,1)","dash":"solid"},"hoveron":"points","name":"Long Beach, CA","legendgroup":"Long Beach, CA","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,3],"y":[4.3,3.7,4.1],"text":["place: Los Angeles, CA<br />year: 2010<br />value:  4.3<br />place: Los Angeles, CA","place: Los Angeles, CA<br />year: 2011<br />value:  3.7<br />place: Los Angeles, CA","place: Los Angeles, CA<br />year: 2012<br />value:  4.1<br />place: Los Angeles, CA"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(36,135,142,1)","dash":"solid"},"hoveron":"points","name":"Los Angeles, CA","legendgroup":"Los Angeles, CA","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[2,3,4,5],"y":[10.3,9.9,8.8,10.1],"text":["place: Miami (Miami-Dade County), FL<br />year: 2011<br />value: 10.3<br />place: Miami (Miami-Dade County), FL","place: Miami (Miami-Dade County), FL<br />year: 2012<br />value:  9.9<br />place: Miami (Miami-Dade County), FL","place: Miami (Miami-Dade County), FL<br />year: 2013<br />value:  8.8<br />place: Miami (Miami-Dade County), FL","place: Miami (Miami-Dade County), FL<br />year: 2014<br />value: 10.1<br />place: Miami (Miami-Dade County), FL"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(33,144,140,1)","dash":"solid"},"hoveron":"points","name":"Miami (Miami-Dade County), FL","legendgroup":"Miami (Miami-Dade County), FL","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,3,4,5,6,7],"y":[6.5,3.3,4.6,6.6,2.8,3.3,6.6],"text":["place: Minneapolis, MN<br />year: 2010<br />value:  6.5<br />place: Minneapolis, MN","place: Minneapolis, MN<br />year: 2011<br />value:  3.3<br />place: Minneapolis, MN","place: Minneapolis, MN<br />year: 2012<br />value:  4.6<br />place: Minneapolis, MN","place: Minneapolis, MN<br />year: 2013<br />value:  6.6<br />place: Minneapolis, MN","place: Minneapolis, MN<br />year: 2014<br />value:  2.8<br />place: Minneapolis, MN","place: Minneapolis, MN<br />year: 2015<br />value:  3.3<br />place: Minneapolis, MN","place: Minneapolis, MN<br />year: 2016<br />value:  6.6<br />place: Minneapolis, MN"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(31,153,138,1)","dash":"solid"},"hoveron":"points","name":"Minneapolis, MN","legendgroup":"Minneapolis, MN","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[2,4,5,6],"y":[3.4,3.6,3.1,2.9],"text":["place: New York City, NY<br />year: 2011<br />value:  3.4<br />place: New York City, NY","place: New York City, NY<br />year: 2013<br />value:  3.6<br />place: New York City, NY","place: New York City, NY<br />year: 2014<br />value:  3.1<br />place: New York City, NY","place: New York City, NY<br />year: 2015<br />value:  2.9<br />place: New York City, NY"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(31,162,135,1)","dash":"solid"},"hoveron":"points","name":"New York City, NY","legendgroup":"New York City, NY","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,3,4,5,6,7],"y":[5.5,6.7,12.9,7.7,5.9,10.3,8.6],"text":["place: Oakland (Alameda County), CA<br />year: 2010<br />value:  5.5<br />place: Oakland (Alameda County), CA","place: Oakland (Alameda County), CA<br />year: 2011<br />value:  6.7<br />place: Oakland (Alameda County), CA","place: Oakland (Alameda County), CA<br />year: 2012<br />value: 12.9<br />place: Oakland (Alameda County), CA","place: Oakland (Alameda County), CA<br />year: 2013<br />value:  7.7<br />place: Oakland (Alameda County), CA","place: Oakland (Alameda County), CA<br />year: 2014<br />value:  5.9<br />place: Oakland (Alameda County), CA","place: Oakland (Alameda County), CA<br />year: 2015<br />value: 10.3<br />place: Oakland (Alameda County), CA","place: Oakland (Alameda County), CA<br />year: 2016<br />value:  8.6<br />place: Oakland (Alameda County), CA"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(37,172,130,1)","dash":"solid"},"hoveron":"points","name":"Oakland (Alameda County), CA","legendgroup":"Oakland (Alameda County), CA","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,3,4,5,7],"y":[6.7,6.8,6.8,7,6.7,7.2],"text":["place: Philadelphia, PA<br />year: 2010<br />value:  6.7<br />place: Philadelphia, PA","place: Philadelphia, PA<br />year: 2011<br />value:  6.8<br />place: Philadelphia, PA","place: Philadelphia, PA<br />year: 2012<br />value:  6.8<br />place: Philadelphia, PA","place: Philadelphia, PA<br />year: 2013<br />value:  7.0<br />place: Philadelphia, PA","place: Philadelphia, PA<br />year: 2014<br />value:  6.7<br />place: Philadelphia, PA","place: Philadelphia, PA<br />year: 2016<br />value:  7.2<br />place: Philadelphia, PA"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(49,181,123,1)","dash":"solid"},"hoveron":"points","name":"Philadelphia, PA","legendgroup":"Philadelphia, PA","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[3,5],"y":[8.7,10],"text":["place: Phoenix, AZ<br />year: 2012<br />value:  8.7<br />place: Phoenix, AZ","place: Phoenix, AZ<br />year: 2014<br />value: 10.0<br />place: Phoenix, AZ"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(64,188,114,1)","dash":"solid"},"hoveron":"points","name":"Phoenix, AZ","legendgroup":"Phoenix, AZ","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[2,3,4,5,6,7],"y":[4.5,6,7.6,5.7,6.2,null],"text":["place: Portland (Multnomah County), OR<br />year: 2011<br />value:  4.5<br />place: Portland (Multnomah County), OR","place: Portland (Multnomah County), OR<br />year: 2012<br />value:  6.0<br />place: Portland (Multnomah County), OR","place: Portland (Multnomah County), OR<br />year: 2013<br />value:  7.6<br />place: Portland (Multnomah County), OR","place: Portland (Multnomah County), OR<br />year: 2014<br />value:  5.7<br />place: Portland (Multnomah County), OR","place: Portland (Multnomah County), OR<br />year: 2015<br />value:  6.2<br />place: Portland (Multnomah County), OR","place: Portland (Multnomah County), OR<br />year: 2016<br />value:   NA<br />place: Portland (Multnomah County), OR"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(83,197,105,1)","dash":"solid"},"hoveron":"points","name":"Portland (Multnomah County), OR","legendgroup":"Portland (Multnomah County), OR","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,3,4,5,6],"y":[8.9,6.4,7.8,7.6,10.6,12],"text":["place: San Antonio, TX<br />year: 2010<br />value:  8.9<br />place: San Antonio, TX","place: San Antonio, TX<br />year: 2011<br />value:  6.4<br />place: San Antonio, TX","place: San Antonio, TX<br />year: 2012<br />value:  7.8<br />place: San Antonio, TX","place: San Antonio, TX<br />year: 2013<br />value:  7.6<br />place: San Antonio, TX","place: San Antonio, TX<br />year: 2014<br />value: 10.6<br />place: San Antonio, TX","place: San Antonio, TX<br />year: 2015<br />value: 12.0<br />place: San Antonio, TX"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(103,204,92,1)","dash":"solid"},"hoveron":"points","name":"San Antonio, TX","legendgroup":"San Antonio, TX","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,3,4,5,6,7],"y":[6.1,6.1,6.7,6.1,7,7.1,7.3],"text":["place: San Diego County, CA<br />year: 2010<br />value:  6.1<br />place: San Diego County, CA","place: San Diego County, CA<br />year: 2011<br />value:  6.1<br />place: San Diego County, CA","place: San Diego County, CA<br />year: 2012<br />value:  6.7<br />place: San Diego County, CA","place: San Diego County, CA<br />year: 2013<br />value:  6.1<br />place: San Diego County, CA","place: San Diego County, CA<br />year: 2014<br />value:  7.0<br />place: San Diego County, CA","place: San Diego County, CA<br />year: 2015<br />value:  7.1<br />place: San Diego County, CA","place: San Diego County, CA<br />year: 2016<br />value:  7.3<br />place: San Diego County, CA"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(127,211,78,1)","dash":"solid"},"hoveron":"points","name":"San Diego County, CA","legendgroup":"San Diego County, CA","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,4],"y":[2.6,3.8],"text":["place: San Francisco, CA<br />year: 2010<br />value:  2.6<br />place: San Francisco, CA","place: San Francisco, CA<br />year: 2013<br />value:  3.8<br />place: San Francisco, CA"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(151,216,63,1)","dash":"solid"},"hoveron":"points","name":"San Francisco, CA","legendgroup":"San Francisco, CA","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[2,3,4],"y":[5.9,6.1,7.1],"text":["place: San Jose, CA<br />year: 2011<br />value:  5.9<br />place: San Jose, CA","place: San Jose, CA<br />year: 2012<br />value:  6.1<br />place: San Jose, CA","place: San Jose, CA<br />year: 2013<br />value:  7.1<br />place: San Jose, CA"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(177,221,46,1)","dash":"solid"},"hoveron":"points","name":"San Jose, CA","legendgroup":"San Jose, CA","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,3,4,5],"y":[3.9,2.9,5.2,3,3.6],"text":["place: Seattle, WA<br />year: 2010<br />value:  3.9<br />place: Seattle, WA","place: Seattle, WA<br />year: 2011<br />value:  2.9<br />place: Seattle, WA","place: Seattle, WA<br />year: 2012<br />value:  5.2<br />place: Seattle, WA","place: Seattle, WA<br />year: 2013<br />value:  3.0<br />place: Seattle, WA","place: Seattle, WA<br />year: 2014<br />value:  3.6<br />place: Seattle, WA"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(203,225,30,1)","dash":"solid"},"hoveron":"points","name":"Seattle, WA","legendgroup":"Seattle, WA","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,3,4,5,6],"y":[11.3,11.1,11.4,10.9,10.8,11.4],"text":["place: U.S. Total, U.S. Total<br />year: 2010<br />value: 11.3<br />place: U.S. Total, U.S. Total","place: U.S. Total, U.S. Total<br />year: 2011<br />value: 11.1<br />place: U.S. Total, U.S. Total","place: U.S. Total, U.S. Total<br />year: 2012<br />value: 11.4<br />place: U.S. Total, U.S. Total","place: U.S. Total, U.S. Total<br />year: 2013<br />value: 10.9<br />place: U.S. Total, U.S. Total","place: U.S. Total, U.S. Total<br />year: 2014<br />value: 10.8<br />place: U.S. Total, U.S. Total","place: U.S. Total, U.S. Total<br />year: 2015<br />value: 11.4<br />place: U.S. Total, U.S. Total"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(229,228,25,1)","dash":"solid"},"hoveron":"points","name":"U.S. Total, U.S. Total","legendgroup":"U.S. Total, U.S. Total","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,3],"y":[5.6,5.4,6.6],"text":["place: Washington, DC<br />year: 2010<br />value:  5.6<br />place: Washington, DC","place: Washington, DC<br />year: 2011<br />value:  5.4<br />place: Washington, DC","place: Washington, DC<br />year: 2012<br />value:  6.6<br />place: Washington, DC"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(253,231,37,1)","dash":"solid"},"hoveron":"points","name":"Washington, DC","legendgroup":"Washington, DC","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":40.8401826484018,"r":7.30593607305936,"b":37.2602739726027,"l":37.2602739726027},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"title":{"text":"Motor Vehicle Fatality Rates by City","font":{"color":"rgba(0,0,0,1)","family":"","size":17.5342465753425},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[0.4,7.6],"tickmode":"array","ticktext":["2010","2011","2012","2013","2014","2015","2016"],"tickvals":[1,2,3,4,5,6,7],"categoryorder":"array","categoryarray":["2010","2011","2012","2013","2014","2015","2016"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":{"text":"Year","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[2.055,14.045],"tickmode":"array","ticktext":["5","10"],"tickvals":[5,10],"categoryorder":"array","categoryarray":["5","10"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":{"text":"Fatality (death/100,000 population)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":7.97011207970112},"y":0.955005624296963},"annotations":[{"text":"place","x":1.02,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":10.6268161062682},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"left","yanchor":"bottom","legendTitle":true}],"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"4417112570ae":{"colour":{},"x":{},"y":{},"type":"scatter"}},"cur_data":"4417112570ae","visdat":{"4417112570ae":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script><!--/html_preserve-->
</div>

<p>Isn’t this amazing? I’m blown away that one additional line of code did all that.</p>

<h3 id="faceting">Faceting</h3>

<p>Ok, one last trick. Say we wanted to give each city its own little plot to understand time-trends within the city. We can certainly get this information from the spaghetti plot but it would undoubtedly cause a headache. Let’s play with <code class="highlighter-rouge">facet_wrap</code> and <code class="highlighter-rouge">facet_grid</code> instead.</p>

<p>The difference between these two isn’t super clear to start with, but basically, <code class="highlighter-rouge">facet_wrap</code> is good if you’re just faceting on one variable (in our case, city). If you want to end up with a separate mini-plot for each combination of two variables (for instance, a mini-plot for female fatalities in Denver, another plot for male fatalities in Denver, and so on for every combination of city and sex), you want <code class="highlighter-rouge">facet_grid</code> (more info <a href="https://ggplot2-book.org/facet.html">here</a>).</p>

<p>We’re going to start with <code class="highlighter-rouge">facet_wrap</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">drive_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Both"</span><span class="p">,</span><span class="w"> </span><span class="n">race_ethnicity</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">place</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="n">vars</span><span class="p">(</span><span class="n">place</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><img src="/figs/2020-07-17-car-crashes/unnamed-chunk-22-1.png" alt="plot of chunk unnamed-chunk-22" height="650px" width="650px" /></p>

<p>Aside from the fact that the x-axis labels are a bit messed up, this is actually pretty nice.</p>

<p>Now let’s try a grid for combinations of place and sex.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">drive_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Both"</span><span class="p">,</span><span class="w"> </span><span class="n">race_ethnicity</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">place</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">facet_grid</span><span class="p">(</span><span class="n">sex</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">place</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="/figs/2020-07-17-car-crashes/unnamed-chunk-23-1.png" alt="plot of chunk unnamed-chunk-23" height="650px" width="650px" /></p>

<p>Oh boy. Let’s go back to <code class="highlighter-rouge">facet_wrap</code> and just do some color-coding for sex rather than trying to make sense of this crazy grid.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">drive_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Both"</span><span class="p">,</span><span class="w"> </span><span class="n">race_ethnicity</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sex</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_line</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sex</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="n">vars</span><span class="p">(</span><span class="n">place</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><img src="/figs/2020-07-17-car-crashes/unnamed-chunk-24-1.png" alt="plot of chunk unnamed-chunk-24" height="650px" width="650px" /></p>

<p>NIIIIICE. If we fix the formatting, this will actually be an ok plot. First off, we should minimize the number of plots displayed horizontally using <code class="highlighter-rouge">ncol</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">drive_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Both"</span><span class="p">,</span><span class="w"> </span><span class="n">race_ethnicity</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sex</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_line</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sex</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="n">vars</span><span class="p">(</span><span class="n">place</span><span class="p">),</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="/figs/2020-07-17-car-crashes/unnamed-chunk-25-1.png" alt="plot of chunk unnamed-chunk-25" height="650px" width="650px" /></p>

<p>Next, let’s fix up the colors, axes, legend, etc.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">drive_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Both"</span><span class="p">,</span><span class="w"> </span><span class="n">race_ethnicity</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"All"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sex</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_line</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sex</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">scale_color_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#996699"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#99CC99"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="n">vars</span><span class="p">(</span><span class="n">place</span><span class="p">),</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">  </span><span class="o">+</span><span class="w"> 
    </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="w">
      </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Motor Vehicle Fatality Rate 2010-2016 by Sex"</span><span class="p">,</span><span class="w">
      </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Year"</span><span class="p">,</span><span class="w">
      </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Fatality (death/100,000 population)"</span><span class="p">,</span><span class="w">
      </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Data source: Big Cities Health Initiative"</span><span class="w">
    </span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="/figs/2020-07-17-car-crashes/unnamed-chunk-26-1.png" alt="plot of chunk unnamed-chunk-26" height="650px" width="650px" /></p>

<p>I’m pretty happy with that. It’s clear we have an issue with Indianapolis (perhaps they only provide the combined male/female figure but not the individual values). It’s also clear that Boston had only 2 years of data and other cities have some missing data as well. But a more interesting finding is comparing Denver to Detroit, which are conveniently side-by-side. Detroit saw a leveling off, whereas Denver saw a sharp increase in male fatalities. San Jose sticks out, too, as the only city where female fatalities surpassed male fatalities (and sharply so…) If I were an analyst looking at traffic safety, I’d put some focus on Denver and San Jose and figure out what’s going on there.</p>

<h2 id="conclusions">Conclusions</h2>

<p>I hope you agree that we did some fun stuff and learned a bit about car crash fatalities. My takeaways were:</p>
<ul>
  <li>There is a huge disparity between male and female motor vehicle fatalities in nearly every big city in the U.S., males experiencing double and sometimes triple the female average fatality rate.</li>
  <li>Detroit has historically had the highest burden of motor vehicle fatalities, but Denver has recently caught up.</li>
  <li><code class="highlighter-rouge">ggplot2</code> is very cool. <code class="highlighter-rouge">ggplotly</code> is also very cool.</li>
</ul>

<p>This is absolutely just a surface-scratch of all the things <code class="highlighter-rouge">ggplot2</code> can do, so please take a look at the links below for more complete package exploration.</p>

<h2 id="further-reading">Further Reading</h2>

<ul>
  <li>A handy <a href="https://rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf">cheat sheet</a></li>
  <li>A beautiful <a href="https://www.r-graph-gallery.com/index.html">collection</a> of R data viz inspiration</li>
</ul>

<h2 id="references">References</h2>

<ul>
  <li>Michonneau F, Teal T, Fournier A, Seok B, Obeng A, Pawlik AN, Conrado AC, Woo K, Lijnzaad P, Hart T, White EP, Marwick B, Bolker B, Jordan KL, Ashander J, Dashnow H, Hertweck K, Cuesta SM, Becker EA, Guillou S, Shiklomanov A, Klinges D, Odom GJ, Jean M, Mislan KAS, Johnson K, Jahn N, Mannheimer S, Pederson S, Pletzer A, Fouilloux A, Switzer C, Bahlai C, Li D, Kerchner D, Rodriguez-Sanchez F, Rajeg GPW, Ye H, Tavares H, Leinweber K, Peck K, Lepore ML, Hancock S, Sandmann T, Hodges T, Tirok K, Jean M, Bailey A, von Hardenberg A, Theobold A, Wright A, Basu A, Johnson C, Voter C, Hulshof C, Bouquin D, Quinn D, Vanichkina D, Wilson E, Strauss E, Bledsoe E, Gan E, Fishman D, Boehm F, Daskalova G, Tavares H, Kaupp J, Dunic J, Keane J, Stachelek J, Herr JR, Millar J, Lotterhos K, Cranston K, Direk K, Tylén K, Chatzidimitriou K, Deer L, Tarkowski L, Chiapello M, Burle M, Ankenbrand M, Czapanskiy M, Moreno M, Culshaw-Maurer M, Koontz M, Weisner M, Johnston M, Carchedi N, Burge OR, Harrison P, Humburg P, Pauloo R, Peek R, Elahi R, Cortijo S, sfn_brt, Umashankar S, Goswami S, Sumedh, Yanco S, Webster T, Reiter T, Pearse W, Li Y (2020). “datacarpentry/R-ecology-lesson: Data Carpentry: Data Analysis and Visualization in R for Ecologists, June 2019.” doi: 10.5281/zenodo.3264888, https://datacarpentry.org/R-ecology-lesson/.</li>
</ul>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>There are people who would trash me for making that statement, given that R has an actual base graphics <a href="https://www.rdocumentation.org/packages/graphics/versions/3.6.2">package</a> and from what I’ve seen, it works just fine. Data people on the internet sometimes <a href="https://flowingdata.com/2016/03/22/comparing-ggplot2-and-r-base-graphics/">argue</a> against <code class="highlighter-rouge">ggplot2</code> since it seems the base graphics can get you similar results with less code. I have no position on the matter - I use <code class="highlighter-rouge">ggplot2</code> because I’m a sheep and that’s what everyone else seems to use (and hence, what you can find a lot more online help for). <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p>Age adjustment is a method used in epidemiology when comparing rates of disease or mortality between populations with different age breakdowns. Roughly speaking, if the population of Austin TX, for instance, is much younger than the average U.S. population, it doesn’t make sense to compare mortality rates directly. We know that older people die more frequently than younger people, so if we want an apples-to-apples comparison of two populations we have to use a weighting scheme. And that’s all age standardization is - a weighting scheme that assigns more weight to certain age categories to “equalize” their weight to that of the reference population. In our example, older people in Austin would get weighted more than younger people. <a href="#fnref:2" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

        
      </section>

      <footer class="page__meta">
        
        


  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#data-visualization" class="page__taxonomy-item" rel="tag">data visualization</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#ggplot2" class="page__taxonomy-item" rel="tag">ggplot2</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#injuries" class="page__taxonomy-item" rel="tag">injuries</a>
    
    </span>
  </p>


        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-07-17T00:00:00-07:00">July 17, 2020</time></p>


      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Visualizing+Motor+Vehicle+Fatalities+with+ggplot2%20http%3A%2F%2Flocalhost%3A4000%2Fdata%2520visualization%2Fggplot2%2Finjuries%2Fcar-crashes%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fdata%2520visualization%2Fggplot2%2Finjuries%2Fcar-crashes%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fdata%2520visualization%2Fggplot2%2Finjuries%2Fcar-crashes%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/phthalates-II/" class="pagination--pager" title="Phthalate Exposure in U.S. Women of Reproductive Age - an NHANES Review, Part II
">Previous</a>
    
    
      <a href="#" class="pagination--pager disabled">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/phthalates-II/" rel="permalink">Phthalate Exposure in U.S. Women of Reproductive Age - an NHANES Review, Part II
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  16 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/phthalates/" rel="permalink">Phthalate Exposure in U.S. Women of Reproductive Age - an NHANES Review, Part I
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  19 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/blog/2020/07/covid_dashboard/" rel="permalink">Summarizing Covid-19 with flexdashboard
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  less than 1 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">
    
    screenshot from jun 16 2020


</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/blog/2020/07/hello-blogworld/" rel="permalink">Hello (blog)World
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  less than 1 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">Why I created this blog…

</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <!--other footer stuff I don't want
<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

--> 

<div class="page__footer-copyright">&copy; 2020 Alice Tivarovsky. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>






<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" defer
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>


  </body>
</html>
